## CAPOS for HubSpot (Chrome Extension + Content Service)

This repo contains:

- **`/extension`**: A Chrome Extension (Manifest V3) that injects a **CAPOS** app entry into HubSpot’s global left navigation rail on `app.hubspot.com`, plus a CAPOS content panel rendered inside HubSpot’s main area.
- **`/service`**: A small Express service intended for Render hosting that serves mock content today and can later proxy/query Sanity.

### Repo structure

- **`extension/`**
  - **`src/contentScript/`**: HubSpot augmentation (sidebar icon, hover menu, content panel)
  - **`src/options/`**: Options page (stored in `chrome.storage.sync`)
  - **`dist/`**: Build output used for **Load unpacked** (generated by CI or local build)
- **`service/`**
  - Express API: `GET /menu`, `GET /page/:slug`
- **`.github/workflows/build-extension.yml`**
  - Builds `/extension` and uploads `/extension/dist` as a GitHub Actions artifact

---

## Workflow: test in Chrome without Chrome Web Store

You do **not** need to build locally if you use GitHub Actions artifacts.

### 1) Get the built extension from GitHub Actions

1. Push the repo to GitHub (or ensure it’s already there).
2. Go to the repo → **Actions** tab.
3. Open the latest **Build extension (dist artifact)** workflow run.
4. Download the **`capos-extension-dist`** artifact (it’s a zip).
5. Unzip it. You’ll get a folder containing `manifest.json`, `options.html`, and `assets/`.

### 2) Load unpacked in Chrome

1. Open Chrome → `chrome://extensions`
2. Enable **Developer mode** (top-right)
3. Click **Load unpacked**
4. Select the **unzipped folder** from step 1 (the one that contains `manifest.json`)

### Local build (optional)

If you prefer to build locally instead of using CI:

```bash
cd extension
npm ci
npm run build
```

Then load the `extension/dist` folder in Chrome as an unpacked extension.

### 3) Use it in HubSpot

- Open `https://app.hubspot.com/`
- The CAPOS icon will be injected into the left rail (idempotent; no duplicates across SPA navigation)
- Hover the icon to open the menu (150ms delay)
- Click a menu item to open the CAPOS panel in HubSpot’s main content area

---

## Options (chrome.storage.sync)

Open the extension’s **Details** → **Extension options**, or visit:

- `chrome://extensions` → CAPOS → **Extension options**

Settings:

- **`contentBaseUrl`**: Render service base URL (optional)
  - If set and reachable: uses **RemoteProvider**
  - If missing/unreachable: falls back to **MockProvider**
- **Sanity fields** (scaffold only for later)

---

## Render service (optional for now)

The service is a simple JSON API aligned to future Sanity-backed content.

### Endpoints

- `GET /menu` → `MenuItem[]`
- `GET /page/:slug` → `Page`

### Deploy on Render

Create a new **Web Service** in Render from this repo and set:

- **Root Directory**: `service`
- **Build Command**: `npm ci`
- **Start Command**: `npm start`
- **Environment**:
  - `NODE_VERSION`: `20` (recommended)

After deploy, copy the Render URL and paste it into the extension Options as **`contentBaseUrl`**.

